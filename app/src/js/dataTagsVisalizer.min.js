!function(){angular.module("data-tags-visualizer",["ui.bootstrap"]).constant("Const",{moadlPath:"src/views/",openFilePath:"src/views/",views:{tagSpaceAccordionHtml:"src/views/simpleAccoridonTemplate.html",compoundAccordionHtml:"src/views/compoundAccoridonTemplate.html"},version:"1.0.0"})}(),function(){function a(a,c,f,g,h){return{tagParser:function(d){return b(a,c,d)},desicionGraphParser:function(a){return e(a,f,g,h)},tagSpaceToGraph:function(a){return d(a,c)}}}function b(a,d,e){switch(c(e)){case d.Atomic:return a.atomic(e.name,e.values,e.note);case d.Aggregate:return a.Aggregate(e.name,e.values,e.note,d.Aggregate);case d.Compound:var f=e.fieldTypes.map(function(c){return b(a,d,c)});return a.compound(e.name,f,e.note);case d.Todo:return a.todo(e.name,e.note);default:return a.unknown(e)}}function c(a){return a.type}function d(a,b){function d(a){e.push({data:{id:a.name,tagObject:a}}),c(a)==b.Compound&&a.slots.forEach(function(b){f.push({data:{id:a.name+"_TO_"+b.name,source:a.name,target:b.name}}),d(b)})}var e=[],f=[];return d(a),{nodes:e,edges:f}}function e(a,b,c,d){var e={},h={},i={getStartNode:function(){return i[a.$startNode]}};return angular.forEach(a,function(a,d){if("$startNode"!=d){var j=a.nodes.map(function(a){if(e[a.id])return e[a.id];var f=g(a,c,b);return f.data.parent=d+c.root,e[a.id]=f,f});j.push({data:{id:d+c.root,isRoot:"1",node:{type:c.root,firstId:d}}});var k=a.edges.map(function(a){var b=f(a);return h[b.data.id]?h[b.data.id]:(h[b.data.id]=b,b)});i[d]={edges:k,nodes:j},i[d].getRoot=function(){return d+c.root}}}),d(i)}function f(a){return a.id=a.source+"_TO_"+a.target,{data:a}}function g(a,b,c){var d;switch(a.type){case b.ask:d=c.askNode(a.id,a.question,a.terms,a.answers);break;case b.set:d=c.setNode(a.id,a.assignments);break;case b.call:d=c.callNode(a.id,a.CalleeId);break;case b.end:d=c.endNode(a.id);break;case b.reject:d=c.rejectNode(a.id,a.reason);break;case b.todo:d=c.todNode(a.id,a.text);break;default:d=c.todNode(a.id,a.text)}return{data:{id:a.id,node:d}}}a.$inject=["$slot","tagSpaceTypes","$node","nodeTypes","$desicionGraph"],angular.module("data-tags-visualizer").service("$dataTagDataHandler",a)}(),function(){function a(a){function b(b,c,d){var e;if(angular.isArray(b.value))e="<ul>  <li ng-repeat ='v in value'><assignment-viewer value='v'></assignment-viewer>   </li></ul>";else if(angular.isObject(b.value)){var f=Object.keys(b.value)[0];e="<strong> "+f+":</strong> ",e+=angular.isString(b.value[f])?"<span class='atomicAssignment'>"+b.value[f]+"</span>":"<assignment-viewer value= 'value[\""+f+"\"]'></assignment-viewer>"}var g=a(e)(b);c.append(g)}return{restrict:"E",scope:{value:"="},link:b}}a.$inject=["$compile"],angular.module("data-tags-visualizer").directive("assignmentViewer",a)}(),function(){function a(){return function(a){return new b(a)}}function b(a){for(var b in a)this[b]=a[b]}angular.module("data-tags-visualizer").factory("$desicionGraph",a),b.prototype.findCluster=function(a){for(var b in this)if("$startNode"!=b){var c=this[b].nodes;for(var d in c)if(c[d].data.id==a)return this[b]}return null}}(),function(){function a(){return{rejectNode:function(a,b){return new c(a,b)},endNode:function(a){return new d(a)},todNode:function(a,b){return new e(a,b)},callNode:function(a,b){return new f(a,b)},setNode:function(a,b){return new g(a,b)},askNode:function(a,b,c,d){return new h(a,b,c,d)},unknown:function(a){return new i(a)},isNode:b}}function b(a){if(angular.isObject(a)&&a.hasOwnProperty("type")){for(var b in j)if(j[b]==a.type)return!0;return!1}}function c(a,b){this.id=a,this.reason=b,this.type=j.reject}function d(a){this.id=a,this.type=j.end}function e(a,b){this.id=a,this.note=b,this.type=j.todo}function f(a,b){this.id=a,this.calleeId=b,this.type=j.call}function g(a,b){this.id=a,this.assignments=b,this.type=j.set}function h(a,b,c,d){this.id=a,this.question=b,this.terms=c,this.answers=d,this.type=j.ask}function i(a){angular.forEach(a,function(a,b){this.key=b}),this.type=j.unknown}var j={set:"setNode",ask:"AskNode",call:"CallNode",todo:"TodoNode",end:"EndNode",reject:"RejectNode",unknown:"Unknown",root:"$$root"};angular.module("data-tags-visualizer").constant("nodeTypes",j).service("$node",a)}(),function(){function a(){return{atomic:function(a,d,e){return new c(a,d,e,b.Atomic)},Aggregate:function(a,d,e){return new c(a,d,e,b.Aggregate)},todo:function(a,d){return new c(a,[],d,b.Todo)},compound:function(a,b,c){return new d(a,b,c)},unknown:function(a){return new e(a)}}}var b={Todo:"ToDoType",Atomic:"AtomicType",Compound:"CompoundType",Aggregate:"AggregateType",Unknown:"UnknownType"},c=(angular.module("data-tags-visualizer").constant("tagSpaceTypes",b).service("$slot",a),function(a,b,c,d){this.type=d,this.name=a||"----",this.values=b||[],this.note=c||""}),d=function(a,c,d){this.name=a,this.slots=c,this.note=d||"",this.type=b.Compound},e=function(a){angular.forEach(a,function(a,b){this[a]=b}),angular.isDefined(this.type)||(this.type=""),this.type+="(unknown)"}}(),function(){function a(a){return function(b){switch(b){case a.Atomic:return"(atomic)";case a.Aggregate:return"(aggregated)";case a.Compound:return"(compound)";case a.Todo:return"(todo)";case a.Unknown:return"(unknown)"}}}function b(a,b){function c(b,c,d){var e="<tag-space-accordion tag= tag></tag-space-accordion>";b.$watch("tag",function(d,f){d!=f&&d&&c.append(a(e)(b))});c.on("$destroy",function(){b.$destroy()})}return{scope:{tag:"="},link:c}}function c(a,b){function c(c,d,e){function f(a){var c='<TEMP tag="tag"></TEMP>';switch(a.type){case b.Atomic:case b.Aggregate:case b.Todo:c=c.replace(/TEMP/g,"simple-accordion");break;case b.Compound:c=c.replace(/TEMP/g,"compound-accordion");break;case b.Unknown:c=c.replace(/TEMP/g,"unknown-accordion")}return c}var g=c.$watch("tag",function(e){if(e){g();var h=f(c.tag,b),i=a(h)(c);d.append(i)}});d.on("$destroy",function(){c.$destroy()})}return{scope:{tag:"="},link:c}}function d(a){return{restrict:"E",templateUrl:a.views.tagSpaceAccordionHtml,scope:{tag:"="},link:function(a,b){b.on("$destroy",function(){a.$destroy()})}}}function e(a){return{restrict:"E",templateUrl:a.views.compoundAccordionHtml,scope:{tag:"="},link:function(a,b){b.on("$destroy",function(){a.$destroy()})}}}b.$inject=["$compile","tagSpaceTypes"],c.$inject=["$compile","tagSpaceTypes"],d.$inject=["Const"],e.$inject=["Const"],a.$inject=["tagSpaceTypes"],angular.module("data-tags-visualizer").directive("tagSpace",b).directive("tagSpaceAccordion",c).directive("simpleAccordion",d).directive("compoundAccordion",e).filter("printType",a)}(),function(){function a(a){var b={};return b[a.ask]="#95b2e6",b[a.set]="#537D31",b[a.call]="#F69D1B",b[a.end]="#FF5049",b[a.reject]="#A11219",b[a.todo]="#757575",b[a.root]="white",b}a.$inject=["nodeTypes"],angular.module("data-tags-visualizer").service("nodeColors",a)}(),function(){function a(a,b,c,d){var e={};e.nodeModal=d.moadlPath+"simpleNodeModal.html",e[c.ask]=d.moadlPath+"askNodeModalBody.html",e[c.set]=d.moadlPath+"setNodeModalBody.html",e[c.call]=d.moadlPath+"callNodeModalBody.html",e[c.end]=d.moadlPath+"endNodeModalBody.html",e[c.reject]=d.moadlPath+"endNodeModalBody.html",e[c.todo]=d.moadlPath+"todoNodeModalBody.html",e[c.root]=d.moadlPath+"rootNodeModal.html",e[c.unknown]=d.moadlPath+"unknownNodeModalBody.html",this.openModal=function(c){if(angular.isObject(c)){var d,f=e.nodeModal,g=!0;if(b.isNode(c)){f=e.nodeModal,d=e[c.type];var h=a.open({animation:!0,templateUrl:f,size:"md",controller:["$scope","$uibModalInstance",function(a,b){a.modalContent=d,a.node=c,a.hasbody=g,a.close=function(){b.close()},a["goto"]=function(a){b.close({node:a,action:"add"})},a.gotoAsk=function(a){b.close({node:a,action:"center"})},a.removeGraph=function(a){b.close({node:a,action:"remove"})}}]});return h.result}}}}function b(){return function(a){return a.substring(1,a.length-1)}}function c(a){return function(b){var c;switch(b.type){case a.ask:c="Ask Node";break;case a.call:c="Call Node";break;case a.end:c="End Node";break;case a.reject:c="Reject Node";break;case a.set:c="Set Node";break;case a.todo:c="Todo Node";break;case a.root:c=b.firstId+" Sub-Graph ";break;default:c=b.type}return c}}a.$inject=["$uibModal","$node","nodeTypes","Const"],c.$inject=["nodeTypes"],angular.module("data-tags-visualizer").service("ModalHandler",a).filter("printNodeType",c).filter("removeBracketsID",b)}(),function(){function a(){this.get=function(){return f}}function b(a,b,d){return{restrict:"A",scope:{src:"="},link:function(e,f){e.$watch("src",function(g,h){g&&h!=g&&f.ready(function(){var g=a(e.src,f);g.on("tap","node",e.src.nodes,function(a){var d=a.cyTarget,f=b.openModal(d.data().node,g);f.then(function(a){if(a){var d=e.src.findCluster(a.node);c(g,d,a.node,a.action,b)}})}),g.on("mouseover","node",e.src.nodes,function(a){var b=a.cyTarget;"1"!=b.data().isRoot&&b.animate({style:{"border-color":"#000","border-width":3,"border-opacity":.2}},{duration:200})}),g.on("mouseout ","node",e.src.nodes,function(a){var b=a.cyTarget;"1"!=b.data().isRoot&&b.animate({style:{"border-width":0}})}),e.$watch("src",function(a,b){if(a&&b!=a){var c=g.nodes();c.remove(),c=g.add(e.src.getStartNode()),g.layout(g.options),g.center(c)}d(function(){g.resize()},200)}),d(function(){g.resize()},200)})},!0);f.on("$destroy",function(){e.$destroy()})}}}function c(a,b,e,f,g){switch(f){case"add":var h=a.add(b);a.layout(a.options),a.animate({center:h});break;case"remove":var i=a.$("node[parent='"+b.getRoot()+"']");d(i),i=a.$("node[id='"+b.getRoot()+"']"),d(i),a.layout(a.options);break;case"center":var h=a.$("node[id='"+e+"']");a.animate({center:{eles:h},zoom:3,complete:function(){var b=g.openModal(h.data().node,a);b.then(function(b){if(b){var d=scope.src.findCluster(b.node);c(a,d,b.node,b.action,g)}})}})}}function d(a){var b=[],c=1e3/a.length;return a.forEach(function(a,d){a.position();a.animate({style:{opacity:0}},{duration:c*d,complete:function(){b.push(a.remove())}})}),b}function e(a,b){function c(b,c){var e={name:"dagre",nodeSep:void 0,edgeSep:void 0,rankSep:void 0,rankDir:"LR",minLen:function(a){return.5},edgeWeight:function(a){return 5},fit:!0,padding:10,animate:!0,animationDuration:1e3,animationEasing:void 0,boundingBox:void 0,ready:function(){},stop:function(){}},g=cytoscape({container:c,elements:b.getStartNode(),style:[{selector:"node[isRoot='1']",css:{"padding-top":"10px","padding-left":"10px","padding-bottom":"10px","padding-right":"10px","background-color":"white"}},{selector:"node[isRoot!='1']",style:{label:"data(id)","background-color":function(b){return a[b.data().node.type]||"grey"},"text-valign":"center","text-halign":"center","text-outline-color":function(b){return a[b.data().node.type]||"grey"},"text-outline-width":2,"font-size":"14px"}},{selector:"edge",style:{width:2,"line-color":"lightgery","target-arrow-color":"#a9b7f8","target-arrow-shape":"triangle"}}],layout:e});return g.options=e,d(g),f=g,g}function d(a){var b={zoomFactor:.05,zoomDelay:45,minZoom:.1,maxZoom:10,fitPadding:50,panSpeed:10,panDistance:10,panDragAreaSize:75,panMinPercentSpeed:.25,panInactiveArea:8,panIndicatorMinOpacity:.5,zoomOnly:!1,sliderHandleIcon:"fa fa-minus",zoomInIcon:"fa fa-plus",zoomOutIcon:"fa fa-minus",resetIcon:"fa fa-expand"};a.panzoom(b)}return function(a,b){return new c(a,b)}}e.$inject=["nodeColors","graphInstance"],b.$inject=["$grpah","ModalHandler","$timeout"],angular.module("data-tags-visualizer").factory("$grpah",e).directive("graph",b).service("graphInstance",a);var f=null}(),function(){function a(a,c,d){function e(e){var f=c.openFileDialog(),g=d.defer();return f.then(function(c){b={decisionGraph:a.desicionGraphParser(c.decisionGraph),tagSpace:a.tagParser(c.tagSpace)},g.resolve(b)}),g.promise}var f={dataIsAvailable:function(){return!!b},getData:e,clearData:function(){b=null}};return f}a.$inject=["$dataTagDataHandler","fileService","$q"],angular.module("data-tags-visualizer").service("dataService",a);var b=null}(),function(){function a(a,c){var d=c.openFilePath+"openFileDialog.html";this.openFileDialog=function(){var c=a.open({animation:!0,templateUrl:d,size:"md",controller:b});return c.result}}function b(a,b,c){a.status="",a.closeDialog=function(){b.dismiss()},a.ok=function(){var d=$("#openFileDialog")[0].files[0],e=new FileReader;e.onloadend=function(d){var e,f=!0;a.status="Loading...";try{e=JSON.parse(d.target.result),angular.isObject(e)&&e.data_tag_json_version==c.version||(f=!1)}catch(g){f=!1}f?b.close(e):a.status="The selected file is not a DataTag json V"+c.version},d?e.readAsText(d):a.status="No file selected..."}}a.$inject=["$uibModal","Const"],b.$inject=["$scope","$uibModalInstance","Const"],angular.module("data-tags-visualizer").service("fileService",a)}();